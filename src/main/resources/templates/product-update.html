<!DOCTYPE html>
<html lang="no" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oppdater produkt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-light bg-white shadow-sm px-4 mb-4">
    <a class="navbar-brand fw-bold" href="/dashboard">
        <span class="me-2">â˜•</span>Lagermester
    </a>
    <ul class="nav">
        <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/products">Products</a></li>
        <li class="nav-item"><a class="nav-link" href="/products/add">Add Product</a></li>
        <li class="nav-item"><a class="nav-link" href="/products/update">Update Stock</a></li>
    </ul>
</nav>

<!-- Innhold -->
<div class="container">

    <h1 class="text-center mb-4">ðŸ”„ Oppdater produkt</h1>

    <!-- Oppdater produkt-skjema -->
    <form th:action="@{/products/update}" method="post" class="card shadow-sm p-4 bg-white">

        <!-- Autocomplete input for produktnavn -->
        <div class="mb-3">
            <label for="nameSearch" class="form-label">SÃ¸k etter produktnavn</label>
            <input type="text" id="nameSearch" class="form-control" placeholder="F.eks. Inza" autocomplete="off">
            <ul id="suggestions" class="list-group mt-1 position-absolute w-100" style="z-index: 999;"></ul>
        </div>

        <!-- Skjult SKU-felt (fylles inn automatisk) -->
        <input type="hidden" id="sku" name="sku">

        <div class="mb-3">
            <label for="quantity" class="form-label">Nytt lagerantall</label>
            <input type="number" class="form-control" id="quantity" name="quantity" placeholder="Skriv inn nytt antall" min="0" required>
        </div>

        <div class="d-flex justify-content-between">
            <a href="/dashboard" class="btn btn-secondary">Tilbake</a>
            <button type="submit" class="btn btn-warning">Oppdater produkt</button>
        </div>

    </form>


</div>
<script>
    const nameInput = document.getElementById("nameSearch");
    const suggestionsList = document.getElementById("suggestions");
    const skuField = document.getElementById("sku");

    nameInput.addEventListener("input", async () => {
        const query = nameInput.value;

        if (query.length < 2) {
            suggestionsList.innerHTML = "";
            return;
        }

        // Hent matching produkter fra backend
        const response = await fetch(`/products/search?query=${query}`);
        const products = await response.json();

        suggestionsList.innerHTML = "";

        products.forEach(product => {
            const li = document.createElement("li");
            li.classList.add("list-group-item", "list-group-item-action");
            li.textContent = `${product.name} (${product.sku})`;
            li.addEventListener("click", () => {
                nameInput.value = product.name;
                skuField.value = product.sku;
                suggestionsList.innerHTML = "";
            });
            suggestionsList.appendChild(li);
        });
    });

    // Skjul forslag nÃ¥r du klikker utenfor
    document.addEventListener("click", (e) => {
        if (!nameInput.contains(e.target) && !suggestionsList.contains(e.target)) {
            suggestionsList.innerHTML = "";
        }
    });
</script>

</body>
</html>
